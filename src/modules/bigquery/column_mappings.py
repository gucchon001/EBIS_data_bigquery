#!/usr/bin/env python
# -*- coding: utf-8 -*-
"""
BigQueryへのデータロード時に使用するカラムマッピングの定義

各レポートタイプごとに、以下の設定を提供します：
- カラム名のマッピング（CSVカラム名 → BigQueryカラム名）
- 日付型カラム
- 整数型カラム
"""

def get_cv_report_mappings():
    """
    CVレポートのカラムマッピングと型変換設定を取得
    
    Returns:
        dict: マッピング設定を含む辞書
    """
    # 基本的なカラムマッピング
    base_mapping = {
        'ユーザーID': 'セッションID',
        'ユーザー名': '会員ID',
        '売上金額': '応募ID',
        '項目1': '教室名',
        '項目2': '学歴',
        '項目3': '都道府県',
        '項目4': '生年月日',
        '項目5': '現在の職業',
    }
    
    # 括弧を_に変換する関数
    def convert_brackets(text):
        return text.replace('（', '_').replace('(', '_').replace('）', '').replace(')', '')
    
    # 間接効果のカラムを動的に生成
    for i in range(2, 11):
        prefix = f'間接効果{i}'
        base_mapping.update({
            f'{prefix}(発生日時)': f'{prefix}_発生日時',
            f'{prefix}(媒体種別)': f'{prefix}_媒体種別',
            f'{prefix}(広告グループ1)': f'{prefix}_広告グループ1',
            f'{prefix}(広告グループ2)': f'{prefix}_広告グループ2',
            f'{prefix}(広告ID)': f'{prefix}_広告ID',
            f'{prefix}(広告名)': f'{prefix}_広告名',
        })
    
    # 直接効果と初回接触のカラムを追加
    additional_mappings = {
        '直接効果(発生日時)': '直接効果_発生日時',
        '直接効果(媒体種別)': '直接効果_媒体種別',
        '直接効果(広告グループ1)': '直接効果_広告グループ1',
        '直接効果(広告グループ2)': '直接効果_広告グループ2',
        '直接効果(広告ID)': '直接効果_広告ID',
        '直接効果(広告名)': '直接効果_広告名',
        '初回接触(発生日時)': '初回接触_発生日時',
        '初回接触(媒体種別)': '初回接触_媒体種別',
        '初回接触(広告グループ1)': '初回接触_広告グループ1',
        '初回接触(広告グループ2)': '初回接触_広告グループ2',
        '初回接触(広告ID)': '初回接触_広告ID',
        '初回接触(広告名)': '初回接触_広告名',
        'CV名': 'CV名',
        'CV時間': 'CV時間',
        'デバイス': 'デバイス',
        '潜伏期間': '潜伏期間',
        '潜伏期間（秒）': '潜伏期間_秒',
        '接触回数': '接触回数'
    }
    
    # マッピングを結合
    base_mapping.update(additional_mappings)
    
    return {
        'column_mapping': base_mapping,
        'date_columns': [
            'CV時間',
            '生年月日',
            '直接効果_発生日時',
            '初回接触_発生日時'
        ] + [f'間接効果{i}_発生日時' for i in range(2, 11)],
        'integer_columns': [
            '応募ID',
            '接触回数',
            '潜伏期間_秒'
        ]
    }

def get_detailed_analysis_mappings():
    """
    詳細分析レポートのカラムマッピングを取得する

    Returns:
        dict: カラムマッピング、日付カラム、整数カラムの設定を含む辞書
    """
    return {
        'column_mapping': {
            'チャネル種別': 'チャネル名',
            'カテゴリ': 'カテゴリ',
            '広告ID': '広告ID',
            '名称': '名称',
            '表示回数': '表示',
            'クリック／流入回数': 'クリック数',
            'CTR': 'CTR',
            'セッション数': 'セッション数',
            '総PV': '総PV',
            '平均PV': '平均PV',
            '直帰数': 'リピート数',
            '直帰率': 'リピート率',
            '総滞在時間': '滞在時間',
            '総滞在時間（秒）': '滞在時間_秒',
            '平均滞在時間': '平均滞在時間',
            '平均滞在時間（秒）': '平均滞在時間_秒',
            '総潜伏期間': '総閲覧時間',
            '総潜伏期間（秒）': '総閲覧時間_秒',
            '平均潜伏期間': '平均閲覧時間',
            '平均潜伏期間（秒）': '平均閲覧時間_秒',
            '応募完了（CV）': '直接動線_CV',
            '応募完了（CVR）': '直接動線_CVR',
            '会員登録完了（CV）': '会員登録動線_CV',
            '会員登録完了（CVR）': '会員登録動線_CVR',
            'CV（合計）': 'CV_合計',
            'CVR（合計）': 'CVR_合計',
            '間接効果2': '間接効果2',
            '間接効果3': '間接効果3',
            '間接効果4': '間接効果4',
            '間接効果5': '間接効果5',
            '間接効果6 - 10': '間接効果6_10',
            '間接効果（合計）': '間接効果_合計',
            '直間比率（直接）': '貢献割合_直接',
            '直間比率（間接）': '貢献割合_間接',
            '初回接触': '初回接触',
            '再配分CV': '再訪問CV',
            '売上総額': '売上送金額',
            '広告コスト': '広告コスト',
            'CPA': 'CPA',
            'TCPA': 'TCPA',
            'ROAS': 'ROAS'
        },
        'date_columns': ['日付', 'データ取得日'],
        'integer_columns': [
            '表示', 'クリック数', 'セッション数', '総PV', 'リピート数',
            '滞在時間_秒', '平均滞在時間_秒', '総閲覧時間_秒', '平均閲覧時間_秒',
            '直接動線_CV', '会員登録動線_CV', 'CV_合計',
            '間接効果2', '間接効果3', '間接効果4', '間接効果5',
            '間接効果6_10', '間接効果_合計', '初回接触'
        ]
    } 